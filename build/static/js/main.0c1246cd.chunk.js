(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{184:function(e,t,a){e.exports=a(381)},189:function(e,t,a){},191:function(e,t,a){},364:function(e,t,a){},381:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(175),i=a.n(s),c=(a(189),a(7)),o=a(8),l=a(11),u=a(9),m=a(12),h=(a(191),a(4)),p=a(36),d=a.n(p),f=a(69),v=a(5),g=a(10),b=a(183),y=a(385),O=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(){Object(h.isEmpty)(this.props.auth)||(console.log(this.props.auth.uid),localStorage.setItem("logged in","true"),this.props.history.push("/messenger/".concat(this.props.auth.uid)))}},{key:"handleLogIn",value:function(){var e=Object(f.a)(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.firebase.login({provider:"google",type:"popup"});case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"container",style:{width:"15%"}},r.a.createElement("div",{style:{margin:"100px auto"}},r.a.createElement(b.a,{onClick:function(){return e.handleLogIn()}})))}}]),t}(n.Component),E=Object(v.d)(Object(h.firebaseConnect)(),y.a,Object(g.b)(function(e){return{auth:e.firebase.auth}}))(O),j=(a(364),a(70)),C=a.n(j),k=function(e){return{type:"GET_USER",uid:e.uid,displayName:e.displayName,avatarUrl:e.avatarUrl,star:e.star}},w=function(e){return function(t,a,n){var r=n();r.auth().onAuthStateChanged(function(a){if(a){var n=a.uid,s={};r.database().ref("users/".concat(n,"/priority/").concat(e)).once("value").then(function(a){if(console.log(a.val()),a.val()){s.isStar=a.val().isStar;var i=a.val().isStar;r.database().ref("users/".concat(e)).once("value").then(function(a){console.log(a.val());var n=a.val(),r=n.displayName,s=n.avatarUrl;t(k({uid:e,displayName:r,avatarUrl:s,star:i}))})}else r.update("users/".concat(n,"/priority/").concat(e),{idChatWith:"".concat(e),isStar:!1,lastChat:0}),r.database().ref("users/".concat(n,"/priority/").concat(e)).once("value").then(function(a){s.isStar=a.val().isStar;var n=a.val().isStar;r.database().ref("users/".concat(e)).once("value").then(function(a){console.log(a.val());var r=a.val(),s=r.displayName,i=r.avatarUrl;t(k({uid:e,displayName:s,avatarUrl:i,star:n}))})})})}})}},S=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(){var e=Object(f.a)(d.a.mark(function e(t){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={star:!t,idAuth:a.props.auth.uid,idChatWith:a.props.chatHeader.uid},e.next=3,a.props.updateStarUser(n);case 3:a.props.getUserFromFirebase(n.idChatWith);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;console.log(this.props.chatHeader);var t="fa fa-star uncheck";return this.props.chatHeader.star&&(t="fa fa-star check"),r.a.createElement("div",{className:"chat-header clearfix"},r.a.createElement("img",{src:this.props.chatHeader.avatarUrl,width:"40px",height:"40px",alt:"avatar"}),r.a.createElement("div",{className:"chat-about"},r.a.createElement("div",{className:"chat-with"},"Chat with ",this.props.chatHeader.displayName)),r.a.createElement("i",{className:t,onClick:function(){return e.onClick(e.props.chatHeader.star)}}))}}]),t}(n.Component),N=Object(v.d)(Object(h.firebaseConnect)(),Object(g.b)(function(e){return{chatHeader:e.userReducer,auth:e.firebase.auth}},function(e){return{updateStarUser:function(t){e(function(e){return function(t,a,n){n().database().ref("users/".concat(e.idAuth,"/priority/").concat(e.idChatWith)).update({isStar:e.star})}}(t))},getUserFromFirebase:function(t){e(w(t))}}}))(S),I=a(24),U=a.n(I),x=a(46),R=a.n(x),A=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.message,t=this.props.auth,a=R()().format("LT"),n=e.message.match(/(https?|ftp:)([^\s]+)/g),s=null;n&&(s=n.map(function(e,t){return r.a.createElement("img",{src:e,key:t})}));var i=e.imgUrl,c=null;return i&&(c=i.map(function(e,t){return r.a.createElement("img",{src:e,key:t})})),e.liClass?r.a.createElement("li",{className:e.liClass},r.a.createElement("div",{className:"message-data align-right"},r.a.createElement("span",{className:"message-data-time"},a)," \xa0 \xa0",r.a.createElement("span",{className:"message-data-name"},t.displayName," "),r.a.createElement("i",{className:"fa fa-circle me"})),r.a.createElement("div",{className:"message my-message float-right"},e.message,c,s)):r.a.createElement("li",null,r.a.createElement("div",{className:"message-data align-left"},r.a.createElement("img",{src:this.props.chatHeader.avatarUrl,alt:"avatar",className:"float-left mr-2"}),r.a.createElement("span",{className:"message-data-name"},this.props.chatHeader.displayName),r.a.createElement("span",{className:"message-data-time"},a),"\xa0 \xa0"),r.a.createElement("div",{className:"message other-message float-left"},e.message,c,s))}}]),t}(n.Component),H=Object(g.b)(function(e){return{chatHeader:e.userReducer}})(A),D=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).scrollToBottom=function(){a.endChat.scrollIntoView({behavior:"smooth"})},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentWillReceiveProps",value:function(e){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(e,t){this.scrollToBottom()}},{key:"render",value:function(){var e=this,t=this.props.auth,a=t.uid,n=this.props.idReceiver,s=a<n?a+n:n+a,i=-1;U.a.values(this.props.messages).forEach(function(e,t){s===U.a.values(e)[0].idMessage&&(i=t)});var c=U.a.values(U.a.values(this.props.messages)[i]),o=null;return c&&(o=c.map(function(e,n){var s=null;return e.idSender===a&&(s="clearfix"),e.liClass=s,r.a.createElement(H,{key:n,message:e,auth:t})})),r.a.createElement("div",{className:"chat-history"},r.a.createElement("ul",null,o),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.endChat=t}}))}}]),t}(n.Component),F=Object(v.d)(Object(h.firebaseConnect)(["messages"]),Object(g.b)(function(e){return{messages:e.firebase.data.messages}}))(D),T=a(71),L=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).onHandleOnClickUser=function(e){a.props.getUserFromFirebase(e);var t="/messenger/".concat(e);a.props.history.push(t)},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.props.user,a="",n="";if(t.value.status.online)a="online",n=r.a.createElement("i",{className:"fa fa-circle online"});else{var s=R()(t.value.status.lastOnline),i=R()(s.toDate()).calendar();a="".concat(i),n=r.a.createElement("i",{className:"fa fa-circle offline"})}return r.a.createElement("li",{className:"clearfix"},r.a.createElement("img",{src:t.value.avatarUrl,alt:"avatar"}),r.a.createElement("div",{className:"about"},r.a.createElement("div",{className:"name",onClick:function(){return e.onHandleOnClickUser(t.key)}},t.value.displayName),r.a.createElement("div",{className:"status"},n,a)))}}]),t}(n.Component),M=Object(y.a)(Object(g.b)(function(e){return{chatHeader:e.userReducer}},function(e){return{getUserFromFirebase:function(t){e(w(t))}}})(L)),W=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).onChange=function(e){var t=e.target.name,n=e.target.value;a.setState(Object(T.a)({},t,n))},a.state={keyword:""},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.props.users,a=this.props.uid,n=U.a.findIndex(t,{key:a}),s=null;if(-1!==n){s=U.a.values(t[n].value.priority);for(var i=0;i<t.length;i++)for(var c=0;c<s.length;c++)t[i].key===s[c].idChatWith&&(t[i].star=s[c].isStar,t[i].lastChat=s[c].lastChat)}var o=[],l=[];if(t)for(var u=0;u<t.length;u++)t[u].starScore=t[u].star?100*new Date:1,t[u].timeScore=t[u].lastChat?t[u].lastChat:1,t[u].value.status.online?o.push(t[u]):l.push(t[u]);o.sort(function(e,t){return t.starScore*t.timeScore-e.starScore*e.timeScore}),l.sort(function(e,t){return t.starScore*t.timeScore-e.starScore*e.timeScore}),t=o.concat(l),console.log(t);var m="";return t&&(console.log(t),""!==this.state.keyword&&(t=t.filter(function(t){return-1!==t.value.displayName.toLowerCase().indexOf(e.state.keyword.toLowerCase())})),m=t.map(function(e,t){return r.a.createElement(M,{key:t,user:e})})),r.a.createElement("div",null,r.a.createElement("div",{className:"search"},r.a.createElement("input",{type:"text",name:"keyword",value:this.state.keyword,onChange:this.onChange,placeholder:"search"}),r.a.createElement("i",{className:"fa fa-search"})),r.a.createElement("ul",{className:"list"},m))}}]),t}(n.Component),B=Object(v.d)(Object(h.firebaseConnect)(["users"]),Object(g.b)(function(e){return{uid:e.firebase.auth.uid,users:e.firebase.ordered.users}}))(W),_=a(109),P=a(47),K=a(180),V=a(181);P.b.add(K.a);var z=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).onChange=function(e){var t=e.target.name,n=e.target.value;a.setState(Object(T.a)({},t,n))},a.onHandleChooseImage=function(e){var t=e.target.files[0],n=new FileReader;n.onloadend=function(){t&&a.setState({previewImage:Object(_.a)(a.state.previewImage).concat([n.result]),listImages:Object(_.a)(a.state.listImages).concat([t])})},n.readAsDataURL(t),e.target.value=null},a.onHanleKey=function(e){if(13===e.keyCode&&a.onSubmit(e),16===e.keyCode&&13===e.keyCode){var t=a.state.message+"\n";a.setState({message:t})}},a.onSubmit=function(e){e.preventDefault();var t=a.props.auth.uid,n=a.props.idReceiver,r=t<n?t+n:n+t;if(""!==a.state.message||0!==a.state.listImages.length){var s={message:a.state.message,idSender:t,idReceiver:n,idMessage:r,time:Date.now(),listImgs:a.state.listImages},i={idSender:t,idReceiver:n};a.props.sendMessage(s),a.props.updateLastChatUser(i),a.setState({message:"",listImages:[],previewImage:[]}),e.target.value=null}},a.onDelete=function(e){var t=a.state.previewImage;t.splice(e,1);var n=a.state.listImages;n.splice(e,1),a.setState({previewImage:t,listImages:n}),console.log(a.state.listImages)},a.state={message:"",listImages:[],previewImage:[]},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.state.previewImage,a=null;return t.length>0&&(a=t.map(function(t,a){return r.a.createElement("div",{key:a,className:"previewImages"},r.a.createElement("div",{className:"Image"},r.a.createElement("button",{onClick:function(){return e.onDelete(a)},style:{color:"red"}},"x"),r.a.createElement("img",{src:t})))})),r.a.createElement("div",{className:"chat-message clearfix"},r.a.createElement("textarea",{name:"message",value:this.state.message,onChange:this.onChange,onKeyDown:this.onHanleKey,id:"message-to-send",placeholder:"Type your message",rows:"3"}),r.a.createElement("i",{className:"fa fa-file-o"})," \xa0\xa0\xa0",r.a.createElement("div",{className:"uploadImage"},r.a.createElement("label",{htmlFor:"file"},r.a.createElement(V.a,{icon:"image",size:"2x"})),r.a.createElement("input",{type:"file",id:"file",accept:"image/*",ref:"fileUploader",onChange:function(t){return e.onHandleChooseImage(t)}})),a,r.a.createElement("button",{onClick:this.onSubmit},"Send"))}}]),t}(n.Component),G=Object(g.b)(function(e){return{auth:e.firebase.auth}},function(e){return{sendMessage:function(t){return e(function(e){return function(t,a,n){console.log(e);var r=n(),s=r.database().ref("messages");if(e.listImgs.length>0){var i=e.listImgs,c={contentType:"image/*"},o=r.storage().ref(),l=[];i.forEach(function(e){l.push(o.child("images/".concat(e.lastModified).concat(e.name)).put(e,c))}),Promise.all(l).then(function(t){l=[],t.forEach(function(e){l.push(e.ref.getDownloadURL())}),Promise.all(l).then(function(t){console.log(t),e.imgUrl=t,s.child(e.idMessage).push(e)})})}else s.child(e.idMessage).push(e)}}(t))},updateLastChatUser:function(t){return e(function(e){return function(t,a,n){var r=n();r.auth().onAuthStateChanged(function(t){if(t){var a=t.uid;r.update("users/".concat(a,"/priority/").concat(e.idReceiver),{lastChat:Date.now()}),r.update("users/".concat(e.idReceiver,"/priority/").concat(a),{lastChat:Date.now()})}})}}(t))}}})(z),J=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(){"true"!==localStorage.getItem("logged in")&&this.props.history.push("/")}},{key:"componentWillMount",value:function(){"false"===localStorage.getItem("logged in")?this.props.history.push("/"):(this.props.setStatus(),this.props.getUserFromFirebase(this.props.match.params.id))}},{key:"handleLogOut",value:function(){this.props.handleLogOut(),this.props.firebase.logout(),localStorage.setItem("logged in","false")}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("h2",{style:{color:"Black"}},"Messenger"),r.a.createElement("h3",{style:{color:"Black"}},"Hello, ",this.props.auth.displayName)),r.a.createElement("div",{className:"container clearfix"},r.a.createElement("button",{className:"float-right",style:{height:"40px",width:"40px"},onClick:function(){return e.handleLogOut()}},r.a.createElement("i",{className:"fas fa-sign-out-alt"})),r.a.createElement("div",{className:"people-list",id:"people-list"},r.a.createElement(B,null)),r.a.createElement("div",{className:"chat"},r.a.createElement(N,null),r.a.createElement(F,{auth:this.props.auth,idReceiver:this.props.match.params.id}),r.a.createElement(G,{auth:this.props.auth,idReceiver:this.props.match.params.id}))))}}]),t}(n.Component),X=Object(v.d)(Object(h.firebaseConnect)(),y.a,Object(g.b)(function(e){return{auth:e.firebase.auth}},function(e){return{handleLogOut:function(){e(function(e,t,a){var n=a(),r=n.auth().currentUser;if(r){var s=r.uid;n.update("users/".concat(s,"/status"),{online:!1}),n.database().ref("users/".concat(s,"/status")).onDisconnect().set({online:!1,lastOnline:n.database.ServerValue.TIMESTAMP})}})},setStatus:function(){e(function(e,t,a){var n=a();n.auth().onAuthStateChanged(function(e){if(e){var t=e.uid;n.update("users/".concat(t,"/status"),{online:!0}),n.database().ref("users/".concat(t,"/status")).onDisconnect().set({online:!1,lastOnline:n.database.ServerValue.TIMESTAMP})}})})},getUserFromFirebase:function(t){e(w(t))}}}))(J),q=a(384),Y=a(383),$=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement(q.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(Y.a,{exact:!0,path:"/",component:E}),r.a.createElement(Y.a,{exact:!0,path:"/messenger/:id",component:X})))}}]),t}(n.Component),Q=Object(h.withFirebase)($);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Z=a(182),ee=[],te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_USER":return{uid:t.uid,displayName:t.displayName,avatarUrl:t.avatarUrl,star:t.star};default:return e}},ae=Object(v.c)({firebase:h.firebaseReducer,userReducer:te}),ne={apiKey:"AIzaSyCWtWsilJYv7G0h0X9m_bBWBXA5yVqkS4w",authDomain:"chatapp-1512189.firebaseapp.com",databaseURL:"https://chatapp-1512189.firebaseio.com",projectId:"chatapp-1512189",storageBucket:"chatapp-1512189.appspot.com",messagingSenderId:"305899554852"},re={userProfile:"users",attachAuthIsReady:!0,firebaseStateName:"firebase"};var se=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],C.a.initializeApp(ne);var e=Object(v.d)(Object(h.reactReduxFirebase)(C.a,re),Object(v.a)(Z.a.withExtraArgument(h.getFirebase)))(v.e)(ae);return e.firebaseAuthIsReady.then(function(){console.log("Auth has loaded")}),e}(window.__INITIAL_STATE__);i.a.render(r.a.createElement(g.a,{store:se},r.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[184,2,1]]]);
//# sourceMappingURL=main.0c1246cd.chunk.js.map